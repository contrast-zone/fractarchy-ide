<!DOCTYPE html>
<!--?xml version="1.0"?-->
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:svg="http://www.w3.org/2000/svg">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <title>Fractabase</title>
    <link rel="icon" type="image/png" href="./media/favicon128.png"/>

    <!-- Primary Meta Tags -->
    <meta name="title" content="Fractarchy">
    <meta name="description" content="fractal-structure inspired, parent-child orbiting, zooming-elements based content management system">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://contrast-zone.github.io/moonlight">
    <meta property="og:title" content="Fractarchy">
    <meta property="og:description" content="fractal-structure inspired, parent-child orbiting, zooming-elements based content management system">
    <meta property="og:image" content="media/socmedia.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://contrast-zone.github.io/moonlight">
    <meta property="twitter:title" content="Fractarchy">
    <meta property="twitter:description" content="fractal-structure inspired, parent-child orbiting, zooming-elements based content management system">
    <meta property="twitter:image" content="media/socmedia.png">

    <!--meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" /-->
    
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
   
    <head>
        <style media="screen">
            html, body
            {
                overflow: hidden;
                height: 100%;
                width: 100%;
                margin-top: 0px;
                margin-left: 0px;
                pointer-events: auto;
                /*touch-action: pinch-zoom;*/
                touch-action: none;
                user-select: none;
                background-color: gray;
            }

            .center {
              display: flex;
              justify-content: center;
              align-items: center;
              flex-direction: column;
            }
            
            svg {opacity : 0.7;}
            svg:hover {cursor: pointer; opacity :1;}
        </style>
    </head>
    <body>
        <noscript>
            title: Fractabase
            tags: fractal-structure-inspired, parent-child-orbiting, zooming-elements-based
            powered with ‚ù§ by fractarchy cms
        </noscript>
        <iframe id="source" src="src/source-browse.html" style="border-style:none; position:fixed;/* top:0; left:0; bottom:0; right:0; width:100%; height:100%;*/ border:none; background-color: gray;"></iframe>
        <iframe id="target" src="src/target-browse.html" style="border-style:none; position:fixed;/* top:0; left:0; bottom:0; right:0; width:100%; height:100%;*/ border:none; background-color: gray;"></iframe>
        <a id="fullscrbtn" class="btn" style="position: absolute; text-shadow: 0px 0px 10px black;" hidden>
            <i class="material-icons" style="font-size: 7em;">fullscreen</i>
        </a>
        <a id="btnlhlp" style="position: absolute; /*filter: drop-shadow(0px 0px 5px black);*/" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" height="48" width="48">
                <path class="path" fill="rgb(48,48,48)" stroke="rgb(128,128,128)" stroke-width="1px" d="M24.1 35.65q.9 0 1.6-.7.7-.7.7-1.65 0-.9-.7-1.575-.7-.675-1.6-.675-.95 0-1.625.675T21.8 33.35q0 .9.675 1.6.675.7 1.625.7Zm-2.15-7.3h3.7q0-1.2.325-2.275T27.85 23.7q1.45-1.1 2.075-2.4.625-1.3.625-2.9 0-2.8-1.65-4.475-1.65-1.675-4.5-1.675-2.6 0-4.65 1.425-2.05 1.425-3 3.775l3.45 1.3q.6-1.45 1.625-2.2 1.025-.75 2.225-.75 1.25 0 2.1.725.85.725.85 1.975 0 .9-.575 1.825-.575.925-1.575 1.725-1.4 1.2-2.15 2.625t-.75 3.675ZM24 45.25q-4.4 0-8.275-1.65T8.95 39.05q-2.9-2.9-4.55-6.775Q2.75 28.4 2.75 24q0-4.45 1.65-8.325 1.65-3.875 4.55-6.75t6.775-4.55Q19.6 2.7 24 2.7q4.45 0 8.325 1.675 3.875 1.675 6.75 4.55t4.55 6.75Q45.3 19.55 45.3 24q0 4.4-1.675 8.275t-4.55 6.775q-2.875 2.9-6.75 4.55T24 45.25Zm0-4.7q6.9 0 11.725-4.825Q40.55 30.9 40.55 24q0-6.9-4.825-11.725Q30.9 7.45 24 7.45q-6.9 0-11.725 4.825Q7.45 17.1 7.45 24q0 6.9 4.825 11.725Q17.1 40.55 24 40.55ZM24 24Z"/>
            </svg>
        </a>
        <a id="btnrhlp" style="position: absolute; /*filter: drop-shadow(0px 0px 5px black);*/" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" height="48" width="48">
                <path class="path" fill="rgb(48,48,48)" stroke="rgb(128,128,128)" stroke-width="1px" d="M24.1 35.65q.9 0 1.6-.7.7-.7.7-1.65 0-.9-.7-1.575-.7-.675-1.6-.675-.95 0-1.625.675T21.8 33.35q0 .9.675 1.6.675.7 1.625.7Zm-2.15-7.3h3.7q0-1.2.325-2.275T27.85 23.7q1.45-1.1 2.075-2.4.625-1.3.625-2.9 0-2.8-1.65-4.475-1.65-1.675-4.5-1.675-2.6 0-4.65 1.425-2.05 1.425-3 3.775l3.45 1.3q.6-1.45 1.625-2.2 1.025-.75 2.225-.75 1.25 0 2.1.725.85.725.85 1.975 0 .9-.575 1.825-.575.925-1.575 1.725-1.4 1.2-2.15 2.625t-.75 3.675ZM24 45.25q-4.4 0-8.275-1.65T8.95 39.05q-2.9-2.9-4.55-6.775Q2.75 28.4 2.75 24q0-4.45 1.65-8.325 1.65-3.875 4.55-6.75t6.775-4.55Q19.6 2.7 24 2.7q4.45 0 8.325 1.675 3.875 1.675 6.75 4.55t4.55 6.75Q45.3 19.55 45.3 24q0 4.4-1.675 8.275t-4.55 6.775q-2.875 2.9-6.75 4.55T24 45.25Zm0-4.7q6.9 0 11.725-4.825Q40.55 30.9 40.55 24q0-6.9-4.825-11.725Q30.9 7.45 24 7.45q-6.9 0-11.725 4.825Q7.45 17.1 7.45 24q0 6.9 4.825 11.725Q17.1 40.55 24 40.55ZM24 24Z"/>
            </svg>
        </a>
        <a id="btnlmenu" style="position: absolute; color: rgb(208,208,208);" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" height="48" width="48"><title>menu</title><path fill="rgb(208,208,208, 0.2)" d="M5.8 36.35v-3.4h36.4v3.4Zm0-10.65v-3.4h36.4v3.4Zm0-10.65v-3.4h36.4v3.4Z"/></svg>
        </a>
        <a id="btnupload" style="position: absolute; color: rgb(208,208,208);">
            <svg id="svginput" xmlns="http://www.w3.org/2000/svg" height="48" width="48" style="display:inline;"><title>input</title><path fill="rgb(208,208,208,0.2)" d="M9.1 42.3q-1.35 0-2.375-1.025T5.7 38.9V28.7h3.4v10.2h29.8V9H9.1v10.3H5.7V9q0-1.4 1.025-2.4t2.375-1h29.8q1.4 0 2.4 1t1 2.4v29.9q0 1.35-1 2.375T38.9 42.3ZM20.8 34l-2.5-2.5 5.75-5.8H5.7v-3.4h18.35l-5.75-5.8 2.5-2.5 10.05 10Z"/></svg>
            <svg id="svglosel" xmlns="http://www.w3.org/2000/svg" height="48" width="48" style="display:none"><title>lose changes</title><path fill="rgb(208,208,208)" d="m16.6 33.6 7.4-7.4 7.4 7.4 2.2-2.2-7.4-7.4 7.4-7.4-2.2-2.2-7.4 7.4-7.4-7.4-2.2 2.2 7.4 7.4-7.4 7.4ZM24 44.3q-4.15 0-7.875-1.6-3.725-1.6-6.475-4.35Q6.9 35.6 5.3 31.9 3.7 28.2 3.7 24t1.6-7.925q1.6-3.725 4.35-6.45Q12.4 6.9 16.1 5.3T24 3.7q4.2 0 7.925 1.6 3.725 1.6 6.45 4.325T42.7 16.05q1.6 3.7 1.6 7.95 0 4.2-1.6 7.9t-4.325 6.45Q35.65 41.1 31.95 42.7q-3.7 1.6-7.95 1.6Zm0-3.4q7.05 0 11.975-4.95T40.9 24q0-7.05-4.925-11.975T24 7.1q-7 0-11.95 4.925Q7.1 16.95 7.1 24q0 7 4.95 11.95Q17 40.9 24 40.9ZM24 24Z"/></svg>
            <svg id="svgkeepl" xmlns="http://www.w3.org/2000/svg" height="48" width="48" style="display:none"><title>keep changes</title><path fill="rgb(208,208,208,0.2)" d="M21.05 33.3 35.3 19l-2.55-2.5-11.7 11.75-5.9-5.9-2.5 2.5Zm2.95 11q-4.15 0-7.875-1.6-3.725-1.6-6.475-4.35Q6.9 35.6 5.3 31.9 3.7 28.2 3.7 24t1.6-7.925q1.6-3.725 4.35-6.45Q12.4 6.9 16.1 5.3T24 3.7q4.2 0 7.925 1.6 3.725 1.6 6.45 4.325T42.7 16.05q1.6 3.7 1.6 7.95 0 4.2-1.6 7.9t-4.325 6.45Q35.65 41.1 31.95 42.7q-3.7 1.6-7.95 1.6Zm0-3.4q7.05 0 11.975-4.95T40.9 24q0-7.05-4.925-11.975T24 7.1q-7 0-11.95 4.925Q7.1 16.95 7.1 24q0 7 4.95 11.95Q17 40.9 24 40.9ZM24 24Z"/></svg>
        </a>
        <a id="btnlfull" style="position: absolute; color: rgb(208,208,208);">
            <svg id="fold" xmlns="http://www.w3.org/2000/svg" height="48" width="48"><title>fold</title><path fill="rgb(208,208,208,0.2)" d="m17.15 40.3-2.45-2.45 9.3-9.3 9.3 9.3-2.45 2.45L24 33.45ZM24 19.45l-9.3-9.3 2.45-2.45L24 14.55l6.85-6.85 2.45 2.45Z"/></svg>
            <svg id="svglfull" xmlns="http://www.w3.org/2000/svg" height="48" width="48"><title>derivation</title><path fill="rgb(208,208,208)" d="M3.7 10.75V1.7h9.05V5H7v5.75Zm37.3 0V5h-5.75V1.7h9.05v9.05ZM3.7 46.3v-9.05H7V43h5.75v3.3Zm31.55 0V43H41v-5.75h3.3v9.05ZM13.3 36.7h21.4V11.3H13.3Zm0 3.45q-1.4 0-2.425-1.025T9.85 36.7V11.3q0-1.4 1.025-2.425T13.3 7.85h21.4q1.4 0 2.425 1.025T38.15 11.3v25.4q0 1.4-1.025 2.425T34.7 40.15Zm5.15-20.6h11.1v-3.1h-11.1Zm0 6h11.1v-3.1h-11.1Zm0 6h11.1v-3.1h-11.1ZM13.3 36.7V11.3v25.4Z"/></svg>
            <svg id="unfold" xmlns="http://www.w3.org/2000/svg" height="48" width="48"><title>unfold</title><path fill="rgb(208,208,208,0.2)" d="M24 42.3 14.7 33l2.5-2.5 6.8 6.8 6.8-6.8 2.5 2.5Zm-6.8-24.6-2.5-2.5L24 5.9l9.3 9.3-2.5 2.5-6.8-6.85Z"/></svg>
        </a>
        <a id="btnlcrop" style="position: absolute; color: rgb(208,208,208);">
            <svg id="svglcropfull" xmlns="http://www.w3.org/2000/svg" height="48" width="48" style="display:inline;"><title>full page</title><path fill="rgb(208,208,208)" d="M9.1 42.3q-1.35 0-2.375-1.025T5.7 38.9V9.1q0-1.4 1.025-2.4t2.375-1h29.8q1.4 0 2.4 1t1 2.4v29.8q0 1.35-1 2.375T38.9 42.3Zm0-3.4h29.8V9.1H9.1v29.8Zm0 0V9.1v29.8Z"/></svg>
            <svg id="svglcrophalf" xmlns="http://www.w3.org/2000/svg" height="48" width="48" style="display:none;"><title>half page</title><path fill="rgb(208,208,208)" d="M28.85 42.3q-1.4 0-2.4-1.025t-1-2.375V9.1q0-1.4 1-2.4t2.4-1h10.2q1.4 0 2.425 1T42.5 9.1v29.8q0 1.35-1.025 2.375T39.05 42.3Zm0-33.2v29.8h10.2V9.1h-10.2ZM8.95 42.3q-1.4 0-2.425-1.025T5.5 38.9V9.1q0-1.4 1.025-2.4t2.425-1h10.2q1.4 0 2.4 1t1 2.4v29.8q0 1.35-1 2.375t-2.4 1.025Zm0-33.2v29.8h10.2V9.1H8.95Zm30.1 0h-10.2 10.2Zm-19.9 0H8.95h10.2Z"/></svg>
        </a>
        <a id="btnrcrop" style="position: absolute; color: rgb(208,208,208);">
            <svg id="svgrcropfull" xmlns="http://www.w3.org/2000/svg" height="48" width="48" style="display:inline;"><title>full page</title><path fill="rgb(48,48,48)" d="M9.1 42.3q-1.35 0-2.375-1.025T5.7 38.9V9.1q0-1.4 1.025-2.4t2.375-1h29.8q1.4 0 2.4 1t1 2.4v29.8q0 1.35-1 2.375T38.9 42.3Zm0-3.4h29.8V9.1H9.1v29.8Zm0 0V9.1v29.8Z"/></svg>
            <svg id="svgrcrophalf" xmlns="http://www.w3.org/2000/svg" height="48" width="48" style="display:none;"><title>half page</title><path fill="rgb(48,48,48)" d="M28.85 42.3q-1.4 0-2.4-1.025t-1-2.375V9.1q0-1.4 1-2.4t2.4-1h10.2q1.4 0 2.425 1T42.5 9.1v29.8q0 1.35-1.025 2.375T39.05 42.3Zm0-33.2v29.8h10.2V9.1h-10.2ZM8.95 42.3q-1.4 0-2.425-1.025T5.5 38.9V9.1q0-1.4 1.025-2.4t2.425-1h10.2q1.4 0 2.4 1t1 2.4v29.8q0 1.35-1 2.375t-2.4 1.025Zm0-33.2v29.8h10.2V9.1H8.95Zm30.1 0h-10.2 10.2Zm-19.9 0H8.95h10.2Z"/></svg>
        </a>
        <a id="btnrfull" style="position: absolute; color: rgb(208,208,208);">
            <svg id="unfold" xmlns="http://www.w3.org/2000/svg" height="48" width="48"><title>unfold</title><path fill="rgb(48,48,48,0.2)" d="M24 42.3 14.7 33l2.5-2.5 6.8 6.8 6.8-6.8 2.5 2.5Zm-6.8-24.6-2.5-2.5L24 5.9l9.3 9.3-2.5 2.5-6.8-6.85Z"/></svg>
            <svg id="svgrfull" xmlns="http://www.w3.org/2000/svg" height="48" width="48"><title>derivation</title><path fill="rgb(48,48,48)" d="M3.7 10.75V1.7h9.05V5H7v5.75Zm37.3 0V5h-5.75V1.7h9.05v9.05ZM3.7 46.3v-9.05H7V43h5.75v3.3Zm31.55 0V43H41v-5.75h3.3v9.05ZM13.3 36.7h21.4V11.3H13.3Zm0 3.45q-1.4 0-2.425-1.025T9.85 36.7V11.3q0-1.4 1.025-2.425T13.3 7.85h21.4q1.4 0 2.425 1.025T38.15 11.3v25.4q0 1.4-1.025 2.425T34.7 40.15Zm5.15-20.6h11.1v-3.1h-11.1Zm0 6h11.1v-3.1h-11.1Zm0 6h11.1v-3.1h-11.1ZM13.3 36.7V11.3v25.4Z"/></svg>
            <svg id="fold" xmlns="http://www.w3.org/2000/svg" height="48" width="48"><title>fold</title><path fill="rgb(48,48,48,0.2)" d="m17.15 40.3-2.45-2.45 9.3-9.3 9.3 9.3-2.45 2.45L24 33.45ZM24 19.45l-9.3-9.3 2.45-2.45L24 14.55l6.85-6.85 2.45 2.45Z"/></svg>
        </a>
        <a id="btndownload" style="position: absolute; color: rgb(48,48,48);">
            <svg id="svgoutput" xmlns="http://www.w3.org/2000/svg" height="48" width="48" style="display:inline;"><title>output</title><path fill="rgb(48,48,48,0.2)" d="M9.1 42.3q-1.35 0-2.375-1.025T5.7 38.9V9.1q0-1.4 1.025-2.4t2.375-1h29.8q1.4 0 2.4 1t1 2.4v4.4h-3.4V9.1H9.1v29.8h29.8v-4.4h3.4v4.4q0 1.35-1 2.375T38.9 42.3Zm25.4-8.85-2.35-2.4 5.3-5.35H18.9v-3.4h18.55l-5.3-5.35 2.35-2.4L43.95 24Z"/></svg>
            <svg id="svgkeepr" xmlns="http://www.w3.org/2000/svg" height="48" width="48" style="display:none"><title>keep changes</title><path fill="rgb(48,48,48,0.2)" d="M21.05 33.3 35.3 19l-2.55-2.5-11.7 11.75-5.9-5.9-2.5 2.5Zm2.95 11q-4.15 0-7.875-1.6-3.725-1.6-6.475-4.35Q6.9 35.6 5.3 31.9 3.7 28.2 3.7 24t1.6-7.925q1.6-3.725 4.35-6.45Q12.4 6.9 16.1 5.3T24 3.7q4.2 0 7.925 1.6 3.725 1.6 6.45 4.325T42.7 16.05q1.6 3.7 1.6 7.95 0 4.2-1.6 7.9t-4.325 6.45Q35.65 41.1 31.95 42.7q-3.7 1.6-7.95 1.6Zm0-3.4q7.05 0 11.975-4.95T40.9 24q0-7.05-4.925-11.975T24 7.1q-7 0-11.95 4.925Q7.1 16.95 7.1 24q0 7 4.95 11.95Q17 40.9 24 40.9ZM24 24Z"/></svg>
            <svg id="svgloser" xmlns="http://www.w3.org/2000/svg" height="48" width="48" style="display:none"><title>lose changes</title><path fill="rgb(48,48,48)" d="m16.6 33.6 7.4-7.4 7.4 7.4 2.2-2.2-7.4-7.4 7.4-7.4-2.2-2.2-7.4 7.4-7.4-7.4-2.2 2.2 7.4 7.4-7.4 7.4ZM24 44.3q-4.15 0-7.875-1.6-3.725-1.6-6.475-4.35Q6.9 35.6 5.3 31.9 3.7 28.2 3.7 24t1.6-7.925q1.6-3.725 4.35-6.45Q12.4 6.9 16.1 5.3T24 3.7q4.2 0 7.925 1.6 3.725 1.6 6.45 4.325T42.7 16.05q1.6 3.7 1.6 7.95 0 4.2-1.6 7.9t-4.325 6.45Q35.65 41.1 31.95 42.7q-3.7 1.6-7.95 1.6Zm0-3.4q7.05 0 11.975-4.95T40.9 24q0-7.05-4.925-11.975T24 7.1q-7 0-11.95 4.925Q7.1 16.95 7.1 24q0 7 4.95 11.95Q17 40.9 24 40.9ZM24 24Z"/></svg>
        </a>
        <a id="btnrmenu" style="position: absolute; color: rgb(208,208,208);" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" height="48" width="48"><title>menu</title><path fill="rgb(48,48,48, 0.2)" d="M5.8 36.35v-3.4h36.4v3.4Zm0-10.65v-3.4h36.4v3.4Zm0-10.65v-3.4h36.4v3.4Z"/></svg>
        </a>
        <div id="helpcontainer" class="center" style="position: absolute; visibility: hidden; left: 0; top: 0; right: 0; bottom: 0; background-color: rgb(48, 48, 48, 0.95);">
            <img id="help" src="media/instr.svg" height="90%" style="cursor:pointer"/>
        </div>
        <script>

            function msgOpen () {
                /*
                document.getElementById("target").contentWindow.postMessage({msg: "open"}, "*");
                */
            }
            
            function msgSave () {
                /*
                document.getElementById("source").contentWindow.postMessage({msg: "save"}, "*");
                */
            }

            var msg = (event) => {
                if (event.data.msg === "full") {
                    document.getElementById("source").contentWindow.location.replace("./src/source-edit.html");
                    document.getElementById("btnlfull").style.display = "none";
                    document.getElementById("svginput").style.display = "none";
                    document.getElementById("svglosel").style.display = "inline";
                    document.getElementById("svgkeepl").style.display = "inline";
                
                    document.getElementById("target").contentWindow.location.replace("./src/target-edit.html");
                    document.getElementById("btnrfull").style.display = "none";
                    document.getElementById("svgoutput").style.display = "none";
                    document.getElementById("svgloser").style.display = "inline";
                    document.getElementById("svgkeepr").style.display = "inline";

                } else if (event.data.msg === "lose") {
                    document.getElementById("source").contentWindow.location.replace("./src/source-browse.html");
                    document.getElementById("svginput").style.display = "inline";
                    document.getElementById("btnlfull").style.display = "inline";
                    document.getElementById("svglosel").style.display = "none";
                    document.getElementById("svgkeepl").style.display = "none";
                    
                    document.getElementById("target").contentWindow.location.replace("./src/target-browse.html");
                    document.getElementById("svgoutput").style.display = "inline";
                    document.getElementById("btnrfull").style.display = "inline";
                    document.getElementById("svgloser").style.display = "none";
                    document.getElementById("svgkeepr").style.display = "none";

                } else if (event.data.msg === "syncSource") {
                    document.getElementById("source").contentWindow.postMessage({msg: "sync", cursor: event.data.cursor, pathLength: event.data.pathLength}, "*");
                    
                } else  if (event.data.msg === "syncTarget") {
                    document.getElementById("target").contentWindow.postMessage({msg: "sync", cursor: event.data.cursor, pathLength: event.data.pathLength}, "*");
                }
            };
            
            document.getElementById("svglfull").addEventListener ("click", function () {
                msg ({data: {msg: "full"}});
            }, false)
            
            document.getElementById("svgrfull").addEventListener ("click", function () {
                msg ({data: {msg: "full"}});
            }, false)
            
            document.getElementById("svglosel").addEventListener ("click", function () {
                msg ({data: {msg: "lose"}});
            }, false)
            
            document.getElementById("svgloser").addEventListener ("click", function () {
                msg ({data: {msg: "lose"}});
            }, false)
            
            //document.getElementById("source").contentWindow.addEventListener("message", document.getElementById("source").contentWindow.msg, false);
            //document.getElementById("target").contentWindow.addEventListener("message", document.getElementById("target").contentWindow.msg, false);

            window.addEventListener("load", () => {
                window.addEventListener("message", msg, false);
                
                document.getElementById("source").addEventListener("mouseenter", function () {
                    //loaded1 = true;
                    //if (loaded2) {
                        document.getElementById("source").contentWindow.postMessage({msg: "unloaded"}, "*");
                        document.getElementById("target").contentWindow.postMessage({msg: "loaded"}, "*");
                    //}
                }, false);
                
                document.getElementById("target").addEventListener("mouseenter", function () {
                    //loaded2 = true;
                    //if (loaded1) {
                        document.getElementById("source").contentWindow.postMessage({msg: "loaded"}, "*");
                        document.getElementById("target").contentWindow.postMessage({msg: "unloaded"}, "*");
                    //}
                }, false);

                document.getElementById("source").contentWindow.addEventListener("touchstart", function () {
                    document.getElementById("source").contentWindow.postMessage({msg: "unloaded"}, "*");
                    document.getElementById("target").contentWindow.postMessage({msg: "loaded"}, "*");
                }, false);
                
                document.getElementById("target").contentWindow.addEventListener("touchstart", function () {
                    document.getElementById("source").contentWindow.postMessage({msg: "loaded"}, "*");
                    document.getElementById("target").contentWindow.postMessage({msg: "unloaded"}, "*");
                }, false);

                setSize();
                
            });


            document.body.style.fontSize = Math.sqrt(window.devicePixelRatio) + "em"

            var setSize = function (orientation) {
                var s = document.getElementById("source");
                var t = document.getElementById("target");
                var hlp = document.getElementById("help");
                var f = document.getElementById("fullscrbtn");
                var lm = document.getElementById("btnlmenu");
                var rm = document.getElementById("btnrmenu");
                var bu = document.getElementById("btnupload");
                var bd = document.getElementById("btndownload");
                var lc = document.getElementById("btnlcrop");
                var rc = document.getElementById("btnrcrop");
                var lh = document.getElementById("btnlhlp");
                var rh = document.getElementById("btnrhlp");
                var lf = document.getElementById("btnlfull");
                var rf = document.getElementById("btnrfull");

                var marg = 4;
                var padd = 1;
                var bord = 12;
                var btns = 48;
                
                s.style.visibility = "visible";
                lm.style.visibility = "visible";
                bu.style.visibility = "visible";
                lc.style.visibility = "visible";
                t.style.visibility = "visible";
                rm.style.visibility = "visible";
                bd.style.visibility = "visible";
                rc.style.visibility = "visible";
                lh.style.visibility = "visible";
                rh.style.visibility = "visible";
                lf.style.visibility = "visible";
                rf.style.visibility = "visible";

                var mmarg = marg;
                var onlyleft = false;
                var onlyright = false;
                if (document.getElementById("svglcrophalf").style.display === "inline") {
                    onlyleft = true;
                    marg = 0;
                    
                } else if (document.getElementById("svgrcrophalf").style.display === "inline") {
                    onlyright = true;
                    marg = 0;
                }
                
                s.style.margin = marg + "px";
                s.style.padding = padd + "px";
                s.style.border = bord + "px solid rgb(48,48,48)";
                s.style.borderBottomWidth = btns + "px";
                s.style.top = "0px";
                s.style.left = "0px";
                s.style.height = "calc(100% - " + (2 * (marg + padd) + bord) + "px - " + btns + "px)";
                
                if (onlyleft) {
                    t.style.visibility = "hidden";
                    rm.style.visibility = "hidden";
                    bd.style.visibility = "hidden";
                    rc.style.visibility = "hidden";
                    rh.style.visibility = "hidden";
                    rf.style.visibility = "hidden";
                    s.style.width = "calc(100% - " + 2 * (marg + padd + bord) + "px)";
                    t.style.width = "calc(100% - " + 2 * (marg + padd + bord) + "px)";
                } else if (!onlyright) {
                    s.style.width = "calc(50% - " + 2 * (marg + padd + bord) + "px)";
                }
                
                setTimeout (() => {
                    lm.style.left = marg + bord + "px";
                    lm.style.top = mmarg + s.offsetTop + s.offsetHeight - lm.offsetHeight + "px";
                    
                    bu.style.left = marg + bord + "px";
                    bu.style.top = mmarg + s.offsetTop + s.offsetHeight - bu.offsetHeight + "px";

                    lc.style.left = (-marg - bord + s.offsetLeft + s.offsetWidth - lc.offsetWidth) + "px";
                    lc.style.top = mmarg + s.offsetTop + s.offsetHeight - lc.offsetHeight + "px";

                    lh.style.left = bord + marg + "px";
                    lh.style.top = marg + bord + "px";

                    lf.style.left = Math.round (s.offsetWidth / 2 - lf.offsetWidth / 2) + "px"
                    lf.style.top = mmarg + s.offsetTop + s.offsetHeight - lc.offsetHeight + "px";
                }, 10);
                
                t.style.margin = marg + "px";
                t.style.padding = padd + "px";
                t.style.border = bord + "px solid rgb(208,208,208)";
                t.style.borderTopWidth = btns + "px";
                t.style.top = "0px";
                t.style.right = "0px";
                t.style.height = "calc(100% - " + (2 * (marg + padd) + bord) + "px - " + btns + "px)";

                if (onlyright) {
                    s.style.visibility = "hidden";
                    lm.style.visibility = "hidden";
                    bu.style.visibility = "hidden";
                    lc.style.visibility = "hidden";
                    lh.style.visibility = "hidden";
                    lf.style.visibility = "hidden";
                    t.style.width = "calc(100% - " + 2 * (marg + padd + bord) + "px)";
                    s.style.width = "calc(100% - " + 2 * (marg + padd + bord) + "px)";
                } else if (!onlyleft) {
                    t.style.width = "calc(50% - " + 2 * (marg + padd + bord) + "px)";
                }
                
                setTimeout (() => {
                    rm.style.top = marg + "px";
                    rm.style.right = marg + bord + "px";

                    bd.style.right = marg + bord + "px";
                    bd.style.top = marg + "px";
                    
                    rc.style.left = (marg + bord + t.offsetLeft) + "px";
                    rc.style.top = marg + "px";

                    rh.style.left = (t.offsetLeft + t.offsetWidth - rh.offsetWidth - bord) + "px";
                    rh.style.top = mmarg + t.offsetTop + t.offsetHeight - rh.offsetHeight - bord + "px";

                    rf.style.top = marg + "px";
                    rf.style.left = t.offsetLeft + Math.round(t.offsetWidth / 2 - rf.offsetWidth / 2) + "px";
                }, 10);
                
                hlp.style.transform = "scale(" + 1 + ")";
                var hh = window.innerHeight / hlp.clientHeight * 0.85;
                hlp.style.transform = "scale(" + hh + ")";

                f.style.right = "0px";
                f.style.top = "0px";
            };

            var toggleFullScreen = function () {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                } else {
                    if (document.exitFullscreen) {
                      document.exitFullscreen();
                    }
                }
            }

            var showHelp = function () {
                var h = document.getElementById("helpcontainer");
                var f = 0.95;
                var fun = function () {
                    if (f > 0) {
                        h.style.opacity = 1 - f;
                        f -= 0.5;
                        setTimeout (fun, 50);
                    } else {
                        h.style.visibility = "visible";
                        h.style.opacity = 1;
                    }
                };
                
                h.style.opacity = 0;
                h.style.visibility = "visible";
                setTimeout(fun, 50);
            }
            
            var hideHelp = function () {
                var h = document.getElementById("helpcontainer");
                var f = 0.95;
                var fun = function () {
                    if (f > 0) {
                        h.style.opacity = f;
                        f -= 0.5;
                        setTimeout (fun, 50);
                    } else {
                        h.style.visibility = "hidden";
                        h.style.opacity = 0;
                    }
                };
                
                h.style.opacity = 1;
                h.style.visibility = "visible";
                setTimeout(fun, 50);
            }
            
            window.addEventListener('resize', function () {
                setSize (screen.orientation.type);
            });

            window.addEventListener("orientationchange", function () {
                setSize (screen.orientation.type);
            });

            document.getElementById("fullscrbtn").addEventListener('click', toggleFullScreen);
            document.getElementById("btnlhlp").addEventListener('click', showHelp);
            document.getElementById("btnrhlp").addEventListener('click', showHelp);
            document.getElementById("helpcontainer").addEventListener('click', hideHelp);
            
            document.getElementById("source").addEventListener("touchstart", function (evt) {
                evt.preventDefault ();
            }, false);

            document.getElementById("target").addEventListener("touchstart", function (evt) {
                evt.preventDefault ();
            }, false);

            document.getElementById("btnlcrop").addEventListener('click', () => {
                if (document.getElementById("svglcropfull").style.display === "none") {
                    document.getElementById("svglcropfull").style.display = "inline";
                    document.getElementById("svglcrophalf").style.display = "none";
                    
                } else {
                    document.getElementById("svglcropfull").style.display = "none";
                    document.getElementById("svglcrophalf").style.display = "inline";
                }
                
                setSize();
            }, false);
            
            document.getElementById("btnrcrop").addEventListener('click', () => {
                if (document.getElementById("svgrcropfull").style.display === "none") {
                    document.getElementById("svgrcropfull").style.display = "inline";
                    document.getElementById("svgrcrophalf").style.display = "none";
                    
                } else {
                    document.getElementById("svgrcropfull").style.display = "none";
                    document.getElementById("svgrcrophalf").style.display = "inline";
                }
                
                setSize();
            }, false);

            document.getElementById("btndownload").addEventListener('click', () => {
                msgSave();
            });
            
            document.getElementById("btnupload").addEventListener('click', () => {
                msgOpen();
            });
            
        </script>
    </body>
</html>
